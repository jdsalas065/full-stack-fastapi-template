# Alembic Database Migrations

This directory contains Alembic database migration scripts.

## Usage

### Create a new migration

To create a new migration based on changes to your models:

```bash
cd backend
alembic revision --autogenerate -m "description of changes"
```

### Apply migrations

To apply all pending migrations to the database:

```bash
cd backend
alembic upgrade head
```

### Rollback migrations

To rollback the last migration:

```bash
cd backend
alembic downgrade -1
```

To rollback to a specific revision:

```bash
cd backend
alembic downgrade <revision_id>
```

### View migration history

To view the migration history:

```bash
cd backend
alembic history
```

To view current database version:

```bash
cd backend
alembic current
```

## Important Notes

1. **Always review autogenerated migrations** - Alembic's autogenerate feature is helpful but not perfect. Always review the generated migration before applying it.

2. **Database URL** - The database URL is configured in `backend/alembic.ini` and reads from environment variables or `app/core/config.py` settings.

3. **Models** - All SQLModel models must be imported in `env.py` for autogenerate to detect them.

4. **Production** - Never use `init_db()` in production. Always use migrations with `alembic upgrade head`.

## Environment Variables

Make sure these environment variables are set:

- `POSTGRES_SERVER` - PostgreSQL server hostname
- `POSTGRES_PORT` - PostgreSQL server port (default: 5432)
- `POSTGRES_USER` - PostgreSQL username
- `POSTGRES_PASSWORD` - PostgreSQL password
- `POSTGRES_DB` - PostgreSQL database name

Or set `DATABASE_URL` directly:
```bash
export DATABASE_URL="postgresql+psycopg://user:password@localhost:5432/dbname"
```
